# Agent Skills 调研整理（核心信息）

本文档将 Agent Skills（技能模式）的主流实现与关键概念整理为可落地的知识基线，供后续在本项目中实现技能系统与技能包时对齐标准。

## 1. 什么是 Agent Skills

Agent Skills 是一种以文件系统为载体的“能力封装”方式：把某类任务的流程、规范、模板、脚本与参考资料，打包为一个可发现、可按需加载的目录结构，使 Agent 在合适时机加载并执行这些流程。

与“工具（Tool / Function Call）”的区别：

- 工具：回答“能做什么”，通常是一次或少量结构化调用（API、脚本、数据库操作等）。
- 技能：回答“如何把事做好”，提供多步 SOP、边界条件、验收标准、失败处理与参考素材；技能内部可调用工具。

## 2. LLM 模型在技能模式中的位置

LLM 模型不属于技能包的一部分，而是 Agent 的推理与决策引擎：

- 负责基于用户请求与当前环境，在可用技能集合中选择应触发的技能。
- 负责在技能被加载后，遵循技能中的流程，调用工具/脚本，完成任务并产出最终结果。
- 负责在执行过程中判断是否需要加载技能的补充资源文件（reference/assets 等）。

技能包本身是“外置的过程知识与资源”，为模型/Agent 提供可复用的操作手册。

## 3. 技能的目录结构（标准形态）

一个技能通常以目录为单位组织，至少包含一个 `SKILL.md`：

```
<skill-root>/
  <skill-name>/
    SKILL.md                 # 必需：YAML 前言 + Markdown 正文
    scripts/                 # 可选：可执行脚本（Python/Bash等）
    reference/               # 可选：详细参考资料（按需读取）
    assets/                  # 可选：模板/示例文件
```

### 3.1 SKILL.md 的组成

`SKILL.md` 文件开头是 YAML Frontmatter（前言区），至少包含：

- `name`：技能名（全局唯一或在命名空间内唯一）
- `description`：触发描述（决定技能何时会被选用）

正文区（Markdown）是技能的“执行指南”，通常包含：

- 目标与边界
- 前置条件与输入输出契约
- 逐步流程（含工具调用时机）
- 失败处理与退出条件
- 验收/自检清单
- 指向 reference/assets/scripts 的索引

## 4. 渐进式披露（Progressive Disclosure）

技能模式的核心机制是渐进式披露：只在需要时加载信息，节省上下文窗口并提升可扩展性。

- Level 1：元数据常驻
  - Agent 启动时只加载每个技能的 `name` 与 `description` 进入“可用技能索引”。
  - 作用：让模型知道“有哪些技能可用，以及何时适用”，但不占用大量 tokens。

- Level 2：技能正文按需加载
  - 当模型/Agent 判断某技能与任务相关时，才读取该技能的 `SKILL.md` 正文进入上下文。

- Level 3：资源文件与脚本按需访问
  - 参考文档、模板、脚本等不自动进入上下文；只有当技能流程需要时才按需读取或执行。
  - 脚本的代码内容通常不需要被放入上下文，Agent 只需将执行结果注入上下文。

## 5. 触发方式与可组合性

典型触发方式：

- 自动触发：模型基于 `description` 与当前请求语义，从技能索引中选择技能。
- 显式触发：用户直接指定技能（例如命令式调用）。

技能可组合（Composability）：

- 一个任务可能需要多个技能共同完成。
- 设计技能时应避免假设“只有本技能存在”，而是以可组合为前提，明确输入输出与边界。

## 6. 分发与安装（Distribution）

常见分发范围：

- 项目级：随项目仓库提交（例如 `<repo>/.agent/skills/...`），团队共享。
- 用户级：用户目录下安装（例如 `~/.agent/skills/...`），跨项目复用。
- 包级/插件级：作为技能包（zip 或 Python 包资源）发布并被安装到目标目录。

建议支持多技能根目录，并定义优先级（例如：项目级 > 用户级 > 内置）。

## 7. 权限与安全风险（重点）

技能系统的安全挑战主要来自两类：

- 提示注入：在技能正文或引用资料中隐藏恶意指令，诱导 Agent 越权访问文件/网络或泄露敏感信息。
- 脚本执行风险：脚本可执行任意命令，可能造成数据破坏或外泄。

常见缓解策略：

- 最小权限：对“可调用工具/能力”进行显式白名单控制（例如仅允许 Read、Grep、RunScript 等）。
- 显式授权：对危险动作（写文件、执行外部命令、网络请求）要求审批或二次确认。
- 可信来源：仅加载经过审核的技能包；对技能包进行校验（签名/哈希/来源域）。
- 安全前言约束：限制 frontmatter 的可用字符/字段，避免前言区成为高优先级注入载体。
- 执行隔离：脚本以受控方式执行（超时、工作目录隔离、环境变量清理、命令白名单）。

## 8. 评估与迭代指标（Evals 视角）

技能迭代应做可重复评估，常见指标：

- 触发质量：触发率、误触发率、漏触发率、触发时机正确性。
- 任务质量：成功率、步骤完整性（是否遵循关键步骤）、产出格式正确性。
- 成本与性能：tokens、时延、工具调用次数、脚本执行次数与失败率。
- 回归与稳定性：版本升级后的关键用例通过率、输出差异、异常分布。
- 安全性：越权工具调用率、敏感文件访问率、可疑指令命中率。

## 9. 术语对齐

- Skill：技能（目录级能力包）
- SKILL.md：技能入口文件（前言元数据 + 正文指南）
- Skill Index：技能索引（只含 name/description 等轻量信息）
- Progressive Disclosure：渐进式披露（三层加载）
- Resource：技能目录下的补充文件（reference/assets/scripts 等）

